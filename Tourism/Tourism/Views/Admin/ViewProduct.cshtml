@model Tourism.ViewModel.ProductViewModel
@{
    ViewData["Title"] = "View Product";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-5">
    <div class="card shadow-lg p-4 rounded-4">
        <h2 class="text-center mb-4 text-primary fw-bold">@Model.name</h2>

        <div class="row">
            <!-- Left column: Product details -->
            <div class="col-md-5">
                <h5 class="fw-bold mt-3">Description</h5>
                <p>@Model.description</p>

                <h5 class="fw-bold mt-3">Category</h5>
                <p>@Model.category</p>

                <h5 class="fw-bold mt-3">Price</h5>
                <p class="text-success fw-semibold">$@Model.price</p>

                <h5 class="fw-bold mt-3">Offer</h5>
                <p>@Model.offer %</p>

                <h5 class="fw-bold mt-3">Stock</h5>
                <p>@Model.count</p>
            </div>

            <!-- Right column: Image Carousel -->
            <div class="col-md-7 text-center">
                <h5 class="fw-bold mb-3">Product Images</h5>

                @if (Model.UploadedImages != null && Model.UploadedImages.Any())
                {
                    <div id="mainImageContainer" class="position-relative mb-3">
                        @{
                            var firstImg = Model.UploadedImages.First();
                            using var stream = new MemoryStream();
                            firstImg.CopyTo(stream);
                            var firstBase64 = Convert.ToBase64String(stream.ToArray());
                            var firstSrc = $"data:image/jpeg;base64,{firstBase64}";
                        }
                        <img id="mainImage" src="@firstSrc"
                             class="rounded-4 shadow-sm img-fluid"
                             style="max-height:400px; object-fit:cover;" alt="Main Image" />

                        <!-- Arrows -->
                        <button id="prevBtn" class="btn btn-dark position-absolute top-50 start-0 translate-middle-y rounded-circle px-3">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button id="nextBtn" class="btn btn-dark position-absolute top-50 end-0 translate-middle-y rounded-circle px-3">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>

                    <!-- Thumbnails -->
                    <div class="d-flex justify-content-center flex-wrap gap-2">
                        @{
                            int index = 0;
                            foreach (var img in Model.UploadedImages)
                            {
                                using var thumbStream = new MemoryStream();
                                img.CopyTo(thumbStream);
                                var thumbBase64 = Convert.ToBase64String(thumbStream.ToArray());
                                var thumbSrc = $"data:image/jpeg;base64,{thumbBase64}";
                                <img src="@thumbSrc"
                                     class="thumbnail-img border border-2 border-transparent rounded-3"
                                     data-index="@index"
                                     style="width:90px; height:90px; object-fit:cover; cursor:pointer;" />
                                index++;
                            }
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted">No images available for this product.</p>
                }
            </div>
        </div>

        <!-- Divider -->
        <hr class="my-4" />

        <!-- Feedback and Actions -->
        <div class="text-center">
            <h5 class="fw-bold mb-3">Admin Review</h5>

            <form asp-controller="Admin" method="post" class="mx-auto" style="max-width:600px;">
                <input type="hidden" name="productId" value="@Model.id" />

                <div class="form-floating mb-3">
                    <textarea class="form-control" placeholder="Enter your feedback here..." name="msg" style="height:120px;"></textarea>
                    <label for="feedback">Feedback / Comments</label>
                </div>

                <div class="d-flex justify-content-center gap-3">

                    <input type="hidden" name="providerId" value="@Model.id" />
                    <input type="hidden" name="serviceId" value="@Model.productId" />
                    <input type="hidden" name="role" value="Merchant" />
                    <button type="submit"
                            formaction="@Url.Action("AcceptService", "Admin")"
                            class="btn btn-success px-4">
                        <i class="bi bi-check-circle me-1"></i> Accept
                    </button>

                    <button type="submit"
                            formaction="@Url.Action("RejectService", "Admin")"
                            class="btn btn-danger px-4">
                        <i class="bi bi-x-circle me-1"></i> Reject
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const thumbnails = document.querySelectorAll(".thumbnail-img");
        const mainImage = document.getElementById("mainImage");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        let currentIndex = 0;
        const imageSources = Array.from(thumbnails).map(img => img.src);

        function updateMainImage(index) {
            currentIndex = index;
            mainImage.src = imageSources[currentIndex];
            thumbnails.forEach(t => t.classList.remove("border-primary"));
            thumbnails[currentIndex].classList.add("border-primary");
        }

        thumbnails.forEach((thumb, index) => {
            thumb.addEventListener("click", () => updateMainImage(index));
        });

        prevBtn.addEventListener("click", () => {
            const newIndex = (currentIndex - 1 + imageSources.length) % imageSources.length;
            updateMainImage(newIndex);
        });

        nextBtn.addEventListener("click", () => {
            const newIndex = (currentIndex + 1) % imageSources.length;
            updateMainImage(newIndex);
        });

        if (thumbnails.length > 0) thumbnails[0].classList.add("border-primary");
    });
</script>
