@using Tourism.Models.Relations
@using Tourism.Models
@model IEnumerable<TouristRoom>

@{
	ViewData["Title"] = "Guest Bookings Log";
	Layout = "~/Views/Shared/HotelLayOut.cshtml"; // This line was added
}

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>@ViewData["Title"]</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

	<style>

		/* 1. Define new theme colors - unified with dashboard */
		:root {
			--primary-color: #9370db; /* Dark Purple */
			--secondary-color: #f47b9c; /* Pink */
			--bg-color: #f8f9fa; /* Very soft background */
			--card-bg: #ffffff; /* Card background */
			/* 🚨 New harmonized badge colors */
			--badge-approved: var(--primary-color);
			--badge-available: #4CAF50; /* Soft Green */
			--badge-pending: #ffc107; /* Warning Yellow */
			--badge-occupied: #dc3545; /* Red (now used for rejected status) */
		}


		/* 2. General Background */
		body {
			/* ✅ Required modification: applying dashboard color gradient */
			background: linear-gradient(135deg, #f5a9f3, #e5e9ec, #9370db);
			min-height: 100vh; /* To ensure full screen height coverage */
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			padding-top: 60px; /* To compensate for the fixed navigation bar */
		}

		/* 🚨 Navbar - to match the dashboard */
		.navbar {
			/* Applying dashboard color gradient */
			background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Stronger shadow */
			position: fixed; /* To ensure it stays fixed at the top */
			top: 0;
			width: 100%;
			z-index: 1030;
		}

		/* 🚨 Color adjustment to ensure visibility of Navbar items on dark background */
		.navbar-brand, .nav-link {
			color: white !important;
		}

		.navbar-toggler-icon {
			/* Changing hamburger icon color to white */
			background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='white' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
		}

		/* 8. Logout Button Styling */
		.btn-logout-gradient {
			/* Use primary theme colors */
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			border: none;
			color: white;
			font-weight: 600;
			border-radius: 20px;
			padding: 8px 18px;
			transition: opacity 0.3s;
		}

			.btn-logout-gradient:hover {
				opacity: 0.9;
				color: white;
			}

		/* 9. Notification Bell Badge Styling */
		.notification-badge {
			position: absolute;
			top: 5px;
			right: 5px;
			padding: 4px 6px;
			font-size: 10px;
			background: var(--secondary-color);
		}

		/* Main Title (h1, used for page titles) */
		h1 {
			text-align: center;
			margin-top: 30px;
			font-weight: 700;
			/* Apply color gradient to the title */
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		/* Sub Title Styling (h2, used in other pages) */
		.container > h2 {
			font-weight: 800;
			margin-top: 25px;
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			border-bottom: 3px solid var(--secondary-color);
			padding-bottom: 15px;
		}

		/* --- New Card Styles --- */

		.booking-card {
			border: none;
			border-radius: 1rem;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Stronger shadow for cards */
			transition: transform 0.3s ease-in-out;
			background-color: white; /* Card background */
			overflow: hidden;
		}

			.booking-card:hover {
				transform: translateY(-5px); /* Lift the card on hover */
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
			}

		.card-header-custom {
			background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
			color: white;
			font-size: 1.2rem;
			font-weight: 700;
			padding: 1rem 1.5rem;
			border-bottom: none;
		}

		.detail-item {
			padding: 0.5rem 0;
			border-bottom: 1px dashed #eee;
		}

			.detail-item:last-child {
				border-bottom: none;
			}

		/* Re-defining badge styles for explicit use in the card */
		.status-badge {
			font-size: 0.85rem;
			padding: 0.3em 0.8em;
			font-weight: 700;
			border-radius: 20px;
			min-width: 100px;
			text-align: center;
		}

		.badge-approved {
			background-color: var(--badge-approved) !important;
			color: white !important;
		}

		.badge-pending {
			background-color: var(--badge-pending) !important;
			color: black !important;
		}

		.badge-rejected {
			background-color: var(--badge-occupied) !important; /* Using occupied color for rejected status (or similar) */
			color: white !important;
		}

		.card-body h5 {
			font-size: 1.4rem;
			color: var(--primary-color);
		}

	</style>
</head>

<body>

	<div class="container py-5">
		<h1 class="text-center mb-5">@ViewData["Title"]</h1>

		@if (!Model.Any())
		{
			<div class="alert alert-info text-center mt-5 p-4 shadow-sm" style="border-radius: 15px;">
				<i class="bi bi-info-circle-fill me-2"></i>
				<h4 class="alert-heading">No Current Bookings</h4>
				<p>There are no active or upcoming bookings at the moment.</p>
			</div>
		}
		else
		{
			<div class="row g-4 justify-content-center">
				@foreach (var booking in Model.OrderByDescending(b => b.startDate))
				{
					// Logic to determine status text and class
					string statusText;
					string statusClass;
					if (booking.endDate < DateTime.Today)
					{
						statusText = "Completed";
						statusClass = "bg-secondary";
					}
					else if (booking.startDate <= DateTime.Today && booking.endDate >= DateTime.Today)
					{
						statusText = "Current Guest";
						statusClass = "badge-approved"; // Use approved color for current guest
					}
					else
					{
						statusText = "Upcoming";
						statusClass = "badge-pending";
					}

					<div class="col-xl-4 col-lg-6 col-md-6 col-12">
						<div class="card booking-card h-100">

							<div class="card-header card-header-custom d-flex justify-content-between align-items-center">
								<span class="fw-bold">Room Booking: @booking.room?.number</span>
								<span class="badge @statusClass status-badge">@statusText</span>
							</div>

							<div class="card-body">

								<h5 class="card-title mb-3 border-bottom pb-2">
									<i class="bi bi-person-circle me-2"></i>
									Guest: <span class="fw-bold">@booking.tourist?.firstName @booking.tourist?.LastName</span>
								</h5>

								<ul class="list-unstyled">
									<li class="detail-item">
										<i class="bi bi-calendar-check text-success me-2"></i>
										Arrival Date: <span class="fw-semibold">@booking.startDate.ToString("yyyy-MM-dd")</span>
									</li>
									<li class="detail-item">
										<i class="bi bi-calendar-x text-danger me-2"></i>
										Departure Date:<span class="fw-semibold">@booking.endDate.ToString("yyyy-MM-dd")</span>
									</li>
									<li class="detail-item">
										<i class="bi bi-people-fill me-2" style="color: var(--primary-color);"></i>
										Number of Guests:<span class="fw-semibold">@booking.numberOfGuests</span>
									</li>
								</ul>
							</div>

							<div class="card-footer text-center bg-light" style="border-top: 1px solid #ddd;">
								@{
									// Calculate estimated cost (Number of days * Room cost)
									double cost = (booking.room?.cost ?? 0) * (booking.endDate - booking.startDate).Days;
								}
								<h5 class="mb-0 text-success">
									<i class="bi bi-cash-stack me-1"></i>
									Estimated Cost: <span class="fw-bold">@(cost.ToString("N2")) EGP</span>
								</h5>
							</div>

						</div>
					</div>
				}
			</div>

			<div class="mt-4 text-center">
				<small class="text-muted">* Only active and upcoming bookings are shown. A Current Guest is one whose booking period is between today's date and the departure date. (EGP stands for Egyptian Pound)</small>
			</div>
		}
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>