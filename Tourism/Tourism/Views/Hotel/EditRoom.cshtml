@model Tourism.Models.Room

@{
    ViewData["Title"] = "Edit Room: " + Model.number;
    var existingImageIds = ViewBag.ExistingImageIds as List<int> ?? new List<int>();
    Layout = "~/Views/Shared/HotelLayOut.cshtml";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

	<style>

		body {
			/* Color gradient matching the requested style */
			background: linear-gradient(135deg, #f5a9f3, #e5e9ec, #9370db);
			min-height: 100vh;
			background-color: #f8f9fa; /* fallback color */
		}
		/* 1. تعريف الألوان الجديدة للثيم - موحدة مع الداشبورد */
		:root {
			--primary-color: #9370db; /* البنفسجي الداكن */
			--secondary-color: #f47b9c; /* الوردي */
			--bg-color: #f8f9fa; /* خلفية ناعمة جداً */
			--card-bg: #ffffff;
			/* 🚨 ألوان البادجات الجديدة المتناسقة */
			--badge-approved: var(--primary-color);
			--badge-available: #4CAF50; /* أخضر ناعم */
			--badge-pending: #ffc107; /* أصفر تحذيري */
			--badge-occupied: #dc3545; /* أحمر خطر (يستخدم الآن للرفض) */
		}


		/* 2. الخلفية العامة */
		body {
			/* ✅ التعديل المطلوب: تطبيق تدرج ألوان الداشبورد */
			background: linear-gradient(135deg, #f5a9f3, #e5e9ec, #9370db);
			min-height: 100vh; /* لضمان تغطية كامل ارتفاع الشاشة */
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			padding-top: 60px; /* لتعويض شريط التنقل الثابت */
		}

		/* 🚨 شريط التنقل (Navbar) - لجعله مطابقًا للداشبورد */
		.navbar {
			/* تطبيق تدرج ألوان الداشبورد */
			background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* ظل أقوى */
			position: fixed; /* للتأكد من ثباته في الأعلى */
			top: 0;
			width: 100%;
			z-index: 1030;
		}

		/* 🚨 تعديل الألوان لضمان رؤية عناصر شريط التنقل على الخلفية الداكنة */
		.navbar-brand, .nav-link {
			color: white !important;
		}

		.navbar-toggler-icon {
			/* تغيير لون أيقونة الهامبرغر إلى الأبيض */
			background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='white' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
		}

		/* 8. Logout Button Styling */
		.btn-logout-gradient {
			/* Use primary theme colors */
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			border: none;
			color: white;
			font-weight: 600;
			border-radius: 20px;
			padding: 8px 18px;
			transition: opacity 0.3s;
		}

			.btn-logout-gradient:hover {
				opacity: 0.9;
				color: white;
			}

		/* 9. Notification Bell Badge Styling */
		.notification-badge {
			position: absolute;
			top: 5px;
			right: 5px;
			padding: 4px 6px;
			font-size: 10px;
			background: var(--secondary-color);
		}

		h1 {
			text-align: center;
			margin-top: 30px;
			font-weight: 700;
			/* Apply color gradient to the title */
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		/* 4. تنسيق العنوان الرئيسي */
		.container > h2 {
			font-weight: 800;
			margin-top: 25px;
			background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			border-bottom: 3px solid var(--secondary-color);
			padding-bottom: 15px;
		}


		/* 5. تنسيق بطاقة الغرفة */
		.room-card {
			transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
			border: none;
			border-radius: 15px;
			margin-bottom: 30px;
			background-color: var(--card-bg);
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
		}

			.room-card:hover {
				transform: translateY(-8px);
				box-shadow: 0 18px 40px rgba(0, 0, 0, 0.2);
			}

		.room-image-container img {
			height: 100%;
			width: 100%;
			object-fit: cover;
		}


		/* 6. تنسيق الفوتر (الأزرار) */
		.card-footer-custom {
			/* ✅ تدرج لوني موحد */
			background: linear-gradient(to right, var(--primary-color), var(--secondary-color)) !important;
			color: white;
			border-top: none;
			border-radius: 0 0 15px 15px;
			padding: 15px 20px;
		}


		/* 7. تنسيق أزرار التعديل والحذف */
		.btn-outline-light {
			border-radius: 20px;
			border: 2px solid rgba(255, 255, 255, 0.9);
			color: white;
			font-weight: 700;
			padding: 6px 15px;
		}

			.btn-outline-light:hover {
				background-color: rgba(255, 255, 255, 0.3);
				color: white;
				border-color: white;
			}


		/* 🚨 8. تنسيق البادجات الجديدة (Custom Badges) */
		.status-badge {
			font-size: 0.85rem; /* تم تصغيره قليلاً ليتناسب مع المساحة */
			padding: 0.3em 0.8em;
			font-weight: 700;
			border-radius: 20px;
			min-width: 100px;
			text-align: center;
		}

		.badge-available {
			background-color: var(--badge-available) !important;
			color: white !important;
		}

		.badge-occupied {
			background-color: var(--badge-occupied) !important;
			color: white !important;
		}

		.badge-rejected { /* New class for denied status */
			background-color: var(--badge-occupied) !important;
			color: white !important;
		}

		.badge-approved {
			background-color: var(--badge-approved) !important;
			color: white !important;
		}

		.badge-pending {
			background-color: var(--badge-pending) !important;
			color: black !important;
		}

		.card-body h5 {
			font-size: 1.4rem;
			color: var(--primary-color);
		}
	</style>
</head>
<body>

    

    @* ================================== *@
    @* FORM - النموذج الرئيسي *@
    @* ================================== *@
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-9">
                <h2 class="mb-4 text-center">Edit Room: @Model.number</h2>
                <hr />

                <form asp-action="EditRoom" asp-controller="Hotel" method="post" enctype="multipart/form-data" class="needs-validation">

                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <input type="hidden" asp-for="id" />
                    <input type="hidden" asp-for="hotelId" />
                    <input type="hidden" asp-for="status" />
                    <input type="hidden" asp-for="accepted" />
                    <input type="hidden" asp-for="dateAdded" />

                    @* ================================== *@
                    @* PART 1: Room Details *@
                    @* ================================== *@
                    <div class="card shadow-lg mb-4" style="border-radius: 10px;">
                        <div class="card-header card-header-primary-gradient">
                            <h5 class="mb-0">Room Details</h5>
                        </div>
                        <div class="card-body">

                            @* 1. Room Number (number) *@
                            <div class="mb-3">
                                <label asp-for="number" class="form-label fw-bold">Room Number *</label>
                                <input asp-for="number" class="form-control" />
                                <span asp-validation-for="number" class="text-danger small"></span>
                            </div>

                            @* 2. Guest Capacity (numberOfMembers) *@
                            <div class="mb-3">
                                <label asp-for="numberOfMembers" class="form-label fw-bold">Guest Capacity *</label>
                                <input asp-for="numberOfMembers" class="form-control" type="number" />
                                <span asp-validation-for="numberOfMembers" class="text-danger small"></span>
                            </div>

                            @* 3. Price (cost) *@
                            <div class="mb-3">
                                <label asp-for="cost" class="form-label fw-bold">Price *</label>
                                <input asp-for="cost" class="form-control" type="number" step="0.01" />
                                <span asp-validation-for="cost" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>

                    @* ================================== *@
                    @* PART 2: Image Management *@
                    @* ================================== *@
                    <div class="card shadow-lg mb-4" style="border-radius: 10px;">
                        <div class="card-header card-header-images-theme">
                            <h5 class="mb-0">Manage Pictures (Max Total: 3)</h5>
                        </div>
                        <div class="card-body">

                            @* Current Images Display - باستخدام قائمة الـ IDs من ViewBag *@
                            @if (existingImageIds.Any())
                            {
                                <h6 class="mb-3" style="color: var(--primary-color);">Current Images (@existingImageIds.Count()) - Check to Delete:</h6>
                                <div class="row g-2 mb-4">
                                    @for (int i = 0; i < existingImageIds.Count; i++)
                                    {
                                        var imageId = existingImageIds[i];
                                        <div class="col-6 col-md-3">
                                            <div class="card p-1 border image-delete-box">
                                                <img src="@Url.Action("GetImage", "Hotel", new { imageId = imageId })"
                                                     class="img-fluid rounded"
                                                     alt="Current Room Image" />
                                                <div class="form-check mt-1 text-center">
                                                    <input class="form-check-input" type="checkbox" name="imagesToDelete" value="@imageId" id="deleteCheck_@i">
                                                    <label class="form-check-label small" for="deleteCheck_@i">
                                                        Delete
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-info">No current images available.</div>
                            }

                            @* New Images Upload *@
                            <div class="mb-3">
                                <label for="newPicFiles" class="form-label fw-bold">Add New Pictures (Max 3 total, including current)</label>
                                <input id="newPicFiles" name="newPicFiles" class="form-control" type="file" accept="image/*" multiple />
                                <span class="text-danger small">@Html.ValidationMessage("NewPicFiles")</span>
                            </div>

                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-submit-gradient btn-lg mb-2">Save Changes</button>
                        <a asp-action="ShowRooms" class="btn btn-secondary-custom btn-lg">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }
    }
</body>
</html>